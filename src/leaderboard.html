<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TQ Stair Leaderboard</title>
    <link rel="stylesheet" href="css/leaderboard.css">
</head>
<body>
  <div class="container">
    <h1>TQ Stair Leaderboard</h1>
    
    <div class="podium" id="podium">
      <!-- Top 3 will be displayed here -->
    </div>
    
    <div id="status" class="status" style="text-align: center; padding: 20px; font-size: 16px; background: #f8f9fa; border-radius: 8px; margin: 20px 0;">
      ðŸ”„ Loading leaderboard...
    </div>
    
    <div id="loading" style="text-align: center; padding: 40px; font-size: 18px;">
      ðŸ”„ Loading leaderboard...
    </div>
    
    <table id="tbl" style="display: none;">
      <thead><tr><th class="rank">#</th><th>Face</th><th>Personal Best</th><th>Attempts</th></tr></thead>
      <tbody></tbody>
    </table>
    
    <div class="admin-section">
      <button id="clearLeaderboard" class="clear-btn">Clear All Data</button>
    </div>
    
    <div class="nav-links">
      <a href="index.html">Main Menu</a>
      <a href="start.html">Start Station</a>
      <a href="stop.html">Stop Station</a>
    </div>
  </div>

  <script type="module">
    console.log('ðŸš€ Starting leaderboard...');
    
    try {
      import('./js/modules/leaderboard.js').then(({ FirebaseLeaderboard }) => {
        console.log('âœ… FirebaseLeaderboard imported successfully');
        
        // Initialize leaderboard
        const leaderboard = new FirebaseLeaderboard();
        console.log('âœ… Leaderboard initialized');
        
        // Make leaderboard available globally for debugging
        window.leaderboard = leaderboard;
        
        // Test Firebase connection
        setTimeout(async () => {
          try {
            const { db, collection, getDocs } = await import('./assets/js/firebase.js');
            const testSnapshot = await getDocs(collection(db, 'users'));
            console.log('âœ… Firebase connection test successful:', testSnapshot.docs.length, 'users found');
          } catch (error) {
            console.error('âŒ Firebase connection test failed:', error);
          }
        }, 2000);
        
      }).catch(error => {
        console.error('âŒ Error importing FirebaseLeaderboard:', error);
        document.getElementById('loading').innerHTML = 'âŒ Error loading leaderboard. Check console for details.';
      });
    } catch (error) {
      console.error('âŒ Error in script:', error);
      document.getElementById('loading').innerHTML = 'âŒ Script error. Check console for details.';
    }
    
    // Clear leaderboard button (hidden admin function)
    document.getElementById('clearLeaderboard').addEventListener('click', async () => {
      const confirmText = prompt('Type "CLEAR" to confirm clearing all data:');
      if (confirmText === 'CLEAR') {
        try {
          await leaderboard.clearAllData();
          alert('All data cleared successfully!');
        } catch (error) {
          console.error('Error clearing data:', error);
          alert('Error clearing data. Check console for details.');
        }
      } else {
        alert('Clear operation cancelled.');
      }
    });
    
    // Test function to create sample data
    window.createTestData = async () => {
      try {
        console.log('ðŸ§ª Creating test data...');
        
        // Create test users
        const testUsers = [
          { name: 'Alice', photo: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=' },
          { name: 'Bob', photo: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=' }
        ];
        
        const { db, collection, addDoc } = await import('./assets/js/firebase.js');
        
        // Save test users
        for (const user of testUsers) {
          await addDoc(collection(db, 'users'), {
            name: user.name,
            photo: user.photo,
            photos: [user.photo],
            lastSeen: Date.now()
          });
        }
        
        // Create test taps (start and stop for each user)
        const now = Date.now();
        for (let i = 0; i < testUsers.length; i++) {
          const userId = `test_user_${i}`;
          const userName = testUsers[i].name;
          
          // Start tap
          await addDoc(collection(db, 'taps'), {
            userId: userId,
            userName: userName,
            station: 'start',
            timestamp: now - (i * 60000), // 1 minute apart
            photo: testUsers[i].photo
          });
          
          // Stop tap (30 seconds later)
          await addDoc(collection(db, 'taps'), {
            userId: userId,
            userName: userName,
            station: 'stop',
            timestamp: now - (i * 60000) + 30000, // 30 seconds after start
            photo: testUsers[i].photo
          });
        }
        
        console.log('âœ… Test data created successfully!');
        alert('Test data created! Check the leaderboard.');
      } catch (error) {
        console.error('Error creating test data:', error);
        alert('Error creating test data. Check console for details.');
      }
    };
    
    // Leaderboard auto-updates in real-time
  </script>
</body>
</html>

